# 数据同步功能说明

## 功能概述

实现了"模型表关系创建"页面和"O线ER关系说明"页面之间的数据同步功能。用户可以在关系创建页面选择表、创建关系，然后这些数据会自动同步到ER关系图页面，实现数据的实时共享。

## 主要功能

### 1. 数据同步机制
- **存储方式**: 使用 `localStorage` 进行客户端数据存储
- **同步时机**: 在以下操作时自动同步数据：
  - 选择/取消选择表
  - 添加/编辑/删除表关系
  - 清空已选表
  - 批量添加表

### 2. 数据导入导出
- **导出功能**: 支持将当前的表和关系数据导出为JSON文件
- **导入功能**: 支持从JSON文件导入表关系数据
- **手动同步**: 提供手动同步按钮，确保数据一致性

### 3. 实时数据刷新
- **自动加载**: ER图页面会自动从localStorage加载最新的数据
- **手动刷新**: 提供"刷新数据"按钮，可以手动重新加载数据
- **数据转换**: 自动将关系创建页面的数据格式转换为ER图页面所需的格式

## 使用方法

### 步骤1: 在关系创建页面操作
1. 打开 `o_line_management.html` 页面
2. 在左侧面板选择数据库和表
3. 在右侧面板创建表关系
4. 数据会自动保存到localStorage

### 步骤2: 查看ER关系图
1. 切换到"O线ER关系说明"标签页
2. ER图会自动显示从关系创建页面同步的数据
3. 如需手动刷新，点击"刷新数据"按钮

### 步骤3: 数据管理
1. 使用"导出数据"按钮保存数据到JSON文件
2. 使用"导入数据"按钮从JSON文件恢复数据
3. 使用"手动同步"按钮确保数据一致性

## 技术实现

### 数据存储结构
```javascript
// localStorage中的数据结构
{
  "o_line_er_data": {
    "tables": {
      "selectedTables": ["table1", "table2"],
      "allTables": ["table1", "table2", "table3"],
      "timestamp": "2024-01-01T00:00:00.000Z"
    },
    "relations": {
      "relations": [
        {
          "sourceTable": "table1",
          "targetTable": "table2",
          "sourceField": "field1",
          "targetField": "field2",
          "relationType": "one-to-many",
          "isFactDim": "是",
          "createTime": "2024-01-01 00:00:00"
        }
      ],
      "timestamp": "2024-01-01T00:00:00.000Z"
    },
    "timestamp": "2024-01-01T00:00:00.000Z"
  }
}
```

### 关键函数
- `saveDataToStorage()`: 保存数据到localStorage
- `loadDataFromStorage()`: 从localStorage加载数据
- `exportDataToJSON()`: 导出数据为JSON文件
- `importDataFromJSON()`: 从JSON文件导入数据
- `reinitializeData()`: 重新初始化ER图数据

## 测试页面

提供了 `test_sync.html` 测试页面，用于验证数据同步功能：
1. 添加测试数据
2. 查看localStorage中的数据
3. 测试页面跳转和数据同步

## 注意事项

1. **浏览器兼容性**: 需要支持localStorage的现代浏览器
2. **数据持久性**: localStorage数据在浏览器中持久保存，但清除浏览器数据会丢失
3. **数据格式**: 导入的JSON文件必须符合指定的数据格式
4. **实时同步**: 数据修改后会自动同步，无需手动操作

## 故障排除

### 数据不同步
1. 检查浏览器控制台是否有错误信息
2. 确认localStorage中是否有数据
3. 尝试手动点击"刷新数据"按钮

### 导入失败
1. 检查JSON文件格式是否正确
2. 确认文件编码为UTF-8
3. 查看浏览器控制台的错误信息

### ER图不显示
1. 确认关系创建页面有数据
2. 检查localStorage中是否有完整的数据结构
3. 尝试刷新页面或重新加载数据
