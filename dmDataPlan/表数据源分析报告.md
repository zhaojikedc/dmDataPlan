# 表数据源分析报告

## 数据源分析

### 1. 主要数据源文件

页面选择库、表信息主要读取以下两个文件：

1. **`o_line_table_info.json`** (主要数据源)
   - 文件大小: 125行
   - 表数量: 3个表
   - 数据结构: 包含表的基本信息和字段定义

2. **`table_metadata.json`** (备用数据源)
   - 文件大小: 1496行
   - 表数量: 6个表
   - 数据结构: 包含更完整的表元数据信息

### 2. 数据加载优先级

根据 `loadTableMetadata()` 函数的实现，数据加载优先级如下：

1. **第一优先级**: `o_line_table_info.json` (通过API)
2. **第二优先级**: `o_line_table_info.json` (直接文件加载)
3. **第三优先级**: `table_metadata.json` (备用数据源)

### 3. 数据完整性分析

#### o_line_table_info.json (主要数据源)
- **表数量**: 3个表
- **包含的表**:
  1. `dim.dim_tp_air_full_cargo_di` (航空全货机维度表)
  2. `dm_pass_atp.tm_air_flow_config_wide` (流向配置宽表)
  3. `dm_tp.dm_tp_air_flow_weight_sum_di` (流向重量汇总事实表)

#### table_metadata.json (备用数据源)
- **表数量**: 6个表
- **包含的表**:
  1. `dim.dim_tp_air_full_cargo_di` (航空全货机维度表)
  2. `dm_pass_atp.tm_air_flow_config_wide` (流向配置宽表)
  3. `dm_tp.dm_tp_air_flow_weight_sum_di` (流向重量汇总事实表)
  4. `dm_tp.dm_tp_air_full_flow_sum_di` (全流向汇总事实表)
  5. `dm_tp.dm_tp_air_full_time_achieve_sum_di` (时效达成汇总事实表)
  6. `dm_tp.dm_tp_air_get_price_dtl_di` (价格明细事实表)

### 4. 数据读取完整性

#### 当前状态
- **主要数据源不完整**: `o_line_table_info.json` 只包含3个表，缺少3个表
- **备用数据源完整**: `table_metadata.json` 包含所有6个表
- **数据加载逻辑**: 优先使用主要数据源，如果失败才使用备用数据源

#### 问题分析
1. **数据不完整**: 主要数据源 `o_line_table_info.json` 缺少3个表
2. **备用机制有效**: 当主要数据源失败时，会自动切换到完整的备用数据源
3. **用户体验**: 如果主要数据源加载成功，用户只能看到3个表；如果失败，用户可以看到完整的6个表

### 5. 数据结构对比

#### o_line_table_info.json 结构
```json
{
  "title": "O线ER关系图",
  "description": "本图展示了系统数据库的实体关系模型，包括事实表和维度表及其关联关系。",
  "tables": [
    {
      "name": "dim.dim_tp_air_full_cargo_di",
      "type": "dim",
      "fields": [...]
    }
  ]
}
```

#### table_metadata.json 结构
```json
{
  "title": "O线数据表元数据",
  "description": "包含所有数据库表的完整结构信息",
  "tables": [
    {
      "name": "dim.dim_tp_air_full_cargo_di",
      "database": "dim",
      "type": "dim",
      "description": "航空全货机维度表",
      "fields": [...]
    }
  ]
}
```

### 6. 建议优化方案

#### 方案1: 更新主要数据源
- 将 `table_metadata.json` 中的完整数据复制到 `o_line_table_info.json`
- 确保主要数据源包含所有6个表

#### 方案2: 调整加载优先级
- 将 `table_metadata.json` 设为主要数据源
- 将 `o_line_table_info.json` 设为备用数据源

#### 方案3: 数据源合并
- 创建一个包含所有表数据的统一文件
- 更新加载逻辑使用统一数据源

### 7. 当前影响

#### 对用户的影响
- 如果主要数据源加载成功，用户只能选择3个表
- 如果主要数据源加载失败，用户可以选择完整的6个表
- 数据不一致可能导致用户体验问题

#### 对功能的影响
- 表关系创建功能可能受限
- 已选表信息可能不完整
- 数据同步可能出现问题

### 8. 验证方法

1. 检查浏览器控制台日志，确认加载了哪个数据源
2. 验证数据库下拉列表中的选项数量
3. 测试表选择功能是否完整
4. 检查已选表信息是否正确

### 9. 结论

**数据读取不完整**：
- 主要数据源 `o_line_table_info.json` 只包含3个表，缺少3个表
- 备用数据源 `table_metadata.json` 包含完整的6个表
- 建议更新主要数据源或调整加载优先级以确保数据完整性
